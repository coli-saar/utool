
\section{Utool in Practice} \label{sec:practice}

We conclude this documentation with some examples for using Utool in
practice. We will start with some tips on how to use Utool
efficiently. Then we will describe a scenario which we have applied a
lot in our papers \cite{FucKolNieTha04,FliKolTha05,KolTha05b}: running
Utool on all MRS descriptions from a HPSG treebank. This second point
will also contain a runtime comparison between Utool and other
underspecification solvers (including the older C++ version of
Utool).

\subsection{Some practical tips}

\begin{enumerate}
\item \textit{Increasing performance.} The Sun implementation of the
Java VM can run in either ``client'' or ``server'' mode. The client
mode is the default, but if you have a long-running process, the
server mode can be significantly more efficient because it
just-in-time compiles and optimises the Java bytecode more
aggressively.

For optimum performance of Utool, we recommend that you run the JVM in
server mode by calling it as follows:
\begin{verbatim}
$ java -server -jar Utool.jar ...
\end{verbatim}
%$

Because of the increased time for startup and compilation, this works
best if you also run Utool in server mode and send it commands via a
socket, because this gives you the most profit out of the JIT
compilation (Utool needs to solve 3--4 USRs to ``warm up'' until it
achieves optimal performance) and eliminates the startup time.

\begin{figure}
\begin{center}
\todo{runtimes for solving chains using server mode and client mode}
\end{center}
\caption{Runtimes for the command \texttt{solve -n -s -I chain
<length>}, running the Java VM in client and server
mode. \label{fig:chains-server-client}}
\end{figure}


\item \textit{Memory consumption.} The chart that Utool computes for
large USRs can grow to eat up quite a bit of your memory. If it grows
larger than the heap limit of the Java VM, Java will throw an
\verb?OutOfMemoryError? and terminate the process. For most USRs that
you will encounter in practice (including almost all USRs in the HPSG
treebanks), the default limit of 256 MB will be sufficient. However,
for those cases where more memory is needed (e.g.\
\verb?rondane-650.mrs.pl? in the examples directory, which has about
$2 \cdot 10^{12}$ solved forms), you can allow Java to use more heap
space by calling it with the \verb?-Xmx512m? option.

\item \textit{XML character entities.} The Utool Server takes commands
as well-formed XML strings, so it expects you to encode special
characters in the USR as XML character entities. You are probably
familiar with having to replace the \" character by \verb?&quot;?
etc., and performing the inverse replacement when decoding the
server's responses.

A lesser known aspect of this, however, is that XML parsers will
ignore whitespace within attribute values according to the XML
specification. In particular, you may use newline characters within a
USR, but these characters will be ignored by the parser. If the
concrete syntax of an input codec requires that there are newlines
(e.g.\ to terminate a comment line in the domcon-oz codec), you must
encode this newline character as the character entity \verb?&#xA;?.
\end{enumerate}




\subsection{Batch processing a treebank with Utool}

The English Resource Grammar (ERG; \citeNP{someone}) is distributed together
with a collection of hand-annotated ``Redwoods-style'' corpora that pair for
each sentence from the corpus the preferred syntactic analysis, together with
a corresponding semantic representation based upon MRS.

The individual MRS expressions can be extracted from the corpora using the
\verb|extract-gold.lisp| script, which can be found \todo{(wo?)}. After
loading the script into a running LKB session, you can use the
\verb|extract-prolog| function (or \verb|extract-xml|) to extract the
individual MRS extractpressions.\footnote{Note that the script is not
compatible with the Redwoods corpus \cite{something}, which uses a slighty
different internal format. You can use the \texttt{itdsb} (REF) environment
instead.} For instance, to extract all MRS expressions from the Rondane
treebank.

\begin{verbatim}
(load "extract-gold")
(extract-prolog "erg/gold/rondane/result" "target-directory" :solve t)
\end{verbatim}

The file "result" refers to the file in the treebank that contains the actual
annotations, and must possibly be unzipped first. The script saves all MRS
expressions in the target directory, each MRS as an individual file. If you
specify \verb|:solve t|, then the MRS constraint solver is applied to each
MRS expressions, and the number of fully scoped MRS expressions is stored in
a file \verb|log| in the target directory. This can be usefull to compare the
results of the MRS solver and Utool, but can take quite a while. If
\verb|:solve t| is omitted, then only the MRS expressions are extracted.

After the MRS expressions have been extracted into individual files, one can
use Utool for instance to classify the MRS expressions as follows:
\begin{verbatim}
	perl utool-client.pl classify -I mrs-prolog target-directory/*.mrs.pl 
\end{verbatim} 

This script prints a table that shows for each MRS expression the result of
the \verb|classify| command, encoded as a bit vector.

\todo{add some benchmark results here: Utool/C++ vs. Java 1.5 vs. Java
1.6, on Linux vs. on Windows, on e.g.\ Rondane or whatever corpus is
convenient for this}




%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "0"
%%% TeX-command-default: "LaTeX"
%%% End: 
